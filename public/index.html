<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>NoteMaster</title>
        <meta name="description" content="A feature-rich note-taking PWA">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="icon" type="image/png" sizes="192x192" href="icons/favicon.png?v=1">
        <link rel="shortcut icon" href="icons/favicon.png?v=1">
        <link rel="apple-touch-icon" href="icons/favicon.png?v=1">
        <link rel="stylesheet" href="css/style.css">
        <link id="dark-mode-stylesheet" rel="stylesheet" href="css/dark.css" disabled>
        <link rel="manifest" href="manifest.json">
    </head>
    <body>
        <!-- Home Page -->
        <div id="page-home" class="page active">
            <div class="home-container">
                <div class="home-content">
                    <img src="images/logo.png" alt="NoteMaster Logo" class="home-logo">
                    <h1>NoteMaster</h1>
                    <p>Your personal note-taking application</p>
                    <div class="home-actions">
                        <button id="btn-go-dashboard" class="btn btn-primary">Get Started</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="page-dashboard" class="page">
            <div class="dashboard-container">
                <header class="dashboard-header">
                    <div class="header-brand">
                        <img src="images/logo.png" alt="NoteMaster Logo" class="header-logo">
                        <h2>Dashboard</h2>
                    </div>
                    <button id="btn-home" class="btn btn-secondary">Home</button>
                </header>
                <div class="dashboard-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="stat-total-notes">0</div>
                            <div class="stat-label">Total Notes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="stat-total-tags">0</div>
                            <div class="stat-label">Total Tags</div>
                        </div>
                    </div>
                    <div class="dashboard-actions">
                        <button id="btn-go-notes" class="btn btn-primary">View Notes</button>
                        <button id="btn-new-note-dashboard" class="btn btn-success">Create Note</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes List Page -->
        <div id="page-notes-list" class="page">
            <div class="notes-list-container">
                <header class="notes-header">
                    <div class="header-brand">
                        <img src="images/logo.png" alt="NoteMaster Logo" class="header-logo">
                        <h2>My Notes</h2>
                    </div>
                    <div class="header-actions">
                        <button id="btn-dashboard" class="btn btn-secondary">Dashboard</button>
                        <button id="btn-new-note" class="btn btn-success">+ New Note</button>
                    </div>
                </header>

                <div class="search-filter-section">
                    <div class="search-box">
                        <input id="search-notes" type="text" placeholder="Search notes by title or content...">
                    </div>
                    <div class="filter-section">
                        <label>Filter by tags:</label>
                        <div id="tags-filter" class="tags-filter"></div>
                    </div>
                </div>

                <div id="notes-grid" class="notes-grid">
                    <p class="empty-message">No notes yet. Create your first note!</p>
                </div>
            </div>
        </div>

        <!-- Editor Page -->
        <div id="page-editor" class="page">
            <div class="editor-container">
                <header class="editor-header">
                    <div class="header-brand">
                        <img src="images/logo.png" alt="NoteMaster Logo" class="header-logo">
                        <h2>Editor</h2>
                    </div>
                    <div class="header-actions">
                        <button id="btn-notes" class="btn btn-secondary">Back to Notes</button>
                        <button id="btn-save-note" class="btn btn-primary">Save</button>
                        <button id="btn-delete-note" class="btn btn-danger">Delete</button>
                    </div>
                </header>

                <div class="editor-content">
                    <div class="editor-main">
                        <div class="title-section">
                            <input id="note-title" type="text" placeholder="Note title...">
                        </div>

                        <div class="tags-section">
                            <label>Tags:</label>
                            <div id="note-tags" class="note-tags"></div>
                            <button id="btn-manage-tags" class="btn btn-small">Manage Tags</button>
                        </div>

                        <div class="editor-toolbar">
                            <h4>Format</h4>
                            <button id="btn-bold" class="btn btn-toolbar" title="Bold"><strong>B</strong></button>
                            <button id="btn-italic" class="btn btn-toolbar" title="Italic"><em>I</em></button>
                            <button id="btn-heading1" class="btn btn-toolbar" title="Heading 1">H1</button>
                            <button id="btn-heading2" class="btn btn-toolbar" title="Heading 2">H2</button>
                            <button id="btn-normal" class="btn btn-toolbar" title="Normal Text">N</button>
                            <button id="btn-bullet" class="btn btn-toolbar" title="Bullet List">â€¢ List</button>
                            <button id="btn-numbered" class="btn btn-toolbar" title="Numbered List">1. List</button>
                        </div>

                        <div id="editor" contenteditable="true" class="editor-area"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tags Manager Modal -->
        <div id="modal-tags" class="modal">
            <div class="modal-content">
                <header class="modal-header">
                    <h3>Manage Tags</h3>
                    <button id="btn-close-tags-modal" class="btn btn-close">&times;</button>
                </header>
                <div class="modal-body">
                    <div class="tag-input-section">
                        <input id="new-tag-input" type="text" placeholder="Enter tag name...">
                        <button id="btn-create-tag" class="btn btn-primary">Create Tag</button>
                    </div>
                    <div id="tags-list" class="tags-list"></div>
                </div>
            </div>
        </div>

        <!-- Theme Toggle -->
        <button id="themeToggle" aria-label="Toggle dark mode" class="btn-theme-toggle">
            <svg id="moon-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg>
        </button>

        <script src="js/api-client.js"></script>
        <script src="js/theme-toggle.js"></script>
        <script src="js/router.js"></script>
        <script src="js/formatter.js"></script>
        <script src="js/tags-manager.js"></script>
        <script src="js/notes-manager.js"></script>
        <script src="js/app.js"></script>
        
        <script>
            // Direct save button handler
            document.addEventListener('DOMContentLoaded', function() {
                const saveBtn = document.getElementById('btn-save-note');
                if (saveBtn) {
                    saveBtn.addEventListener('click', async function(e) {
                        e.preventDefault();
                        console.log('SAVE CLICKED');
                        
                        const noteId = window.currentNoteId;
                        const titleEl = document.getElementById('note-title');
                        const editorEl = document.getElementById('editor');
                        
                        if (!noteId) {
                            alert('No note selected');
                            return;
                        }
                        
                        const title = titleEl ? titleEl.value : 'Untitled';
                        const content = editorEl ? editorEl.innerHTML : '';
                        
                        console.log('Saving note', noteId, 'Title:', title, 'Content length:', content.length);
                        
                        try {
                            const response = await fetch(`http://localhost:3000/api/notes/${noteId}`, {
                                method: 'PUT',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ title, content })
                            });
                            
                            if (response.ok) {
                                alert('Saved!');
                                // Go back to notes list
                                if (window.goToPage && window.PAGES) {
                                    window.goToPage(window.PAGES.NOTES_LIST);
                                    if (window.loadNotesList) {
                                        window.loadNotesList();
                                    }
                                }
                            } else {
                                alert('Error: ' + response.statusText);
                            }
                        } catch (err) {
                            alert('Error: ' + err.message);
                        }
                    });
                }
            });
        </script>
    </body>
</html>